name: ğŸ“ˆ ì£¼ê°€ ë°ì´í„° ì—…ë°ì´íŠ¸

on:
  schedule:
    # í•œêµ­ ì¥ ìš´ì˜ì‹œê°„: KST 09:00~15:30 = UTC 00:00~06:30
    # ì¥ ì¤‘ 30ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸
    - cron: '0,30 0-5 * * 1-5'
    # ì¥ ë§ˆê° ì‹œê° (KST 15:30 = UTC 06:30) ìµœì¢… ì—…ë°ì´íŠ¸
    - cron: '30 6 * * 1-5'
  workflow_dispatch:   # GitHub Actions íƒ­ì—ì„œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  contents: write      # data/prices.json ì»¤ë°‹ì„ ìœ„í•´ ì“°ê¸° ê¶Œí•œ í•„ìš”

jobs:
  update-prices:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: ğŸ Python 3.11 ì„¤ì¹˜
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: |
          pip install pykrx --no-deps
          pip install pandas deprecated multipledispatch requests

      - name: ğŸ“Š ì£¼ê°€ ë°ì´í„° ìˆ˜ì§‘
        run: python scripts/fetch_prices.py

      - name: ğŸ’¾ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ & í‘¸ì‹œ
        run: |
          git config user.name  "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add data/prices.json
          git diff --staged --quiet || \
            git commit -m "ğŸ“ˆ ì£¼ê°€ ì—…ë°ì´íŠ¸: $(TZ='Asia/Seoul' date +'%Y-%m-%d %H:%M KST')"
          git push
